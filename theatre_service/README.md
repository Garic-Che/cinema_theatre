# theatre_service

Сервис для управления фильмами, персонами и жанрами с поиском и рекомендациями.

## Swagger-документация

[/api/v1/theatre/openapi](http://127.0.01/api/v1/theatre/openapi)

## Эндпоинты

### Фильмы (Films)

#### Список фильмов
- **GET** `/api/v1/films/` или `/api/v1/films/search`
- **Описание**: Получение списка фильмов с фильтрацией и поиском
- **Аутентификация**: Не требуется
- **Параметры запроса**:
  - `page_size` (int, 1-100): Количество фильмов на странице (по умолчанию 50)
  - `page_number` (int, ≥1): Номер страницы (по умолчанию 1)
  - `query` (string, опционально): Поисковый запрос
  - `genre_id` (string, опционально): Фильтр по жанру
  - `sort` (string): Сортировка (по умолчанию "-imdb_rating")
- **Ответ**:
```json
[
  {
    "uuid": "123e4567-e89b-12d3-a456-426614174000",
    "imdb_rating": 8.5,
    "title": "The Shawshank Redemption"
  }
]
```

#### Детальная информация о фильме
- **GET** `/api/v1/films/{film_id}`
- **Описание**: Получение полной информации о фильме
- **Аутентификация**: Не требуется
- **Параметры пути**: `film_id` (string)
- **Ответ**:
```json
{
  "uuid": "123e4567-e89b-12d3-a456-426614174000",
  "imdb_rating": 8.5,
  "title": "The Shawshank Redemption",
  "description": "Two imprisoned men bond over a number of years...",
  "genre": [
    {
      "uuid": "123e4567-e89b-12d3-a456-426614174002",
      "name": "Drama"
    }
  ],
  "directors": [
    {
      "uuid": "123e4567-e89b-12d3-a456-426614174003",
      "full_name": "Frank Darabont"
    }
  ],
  "actors": [
    {
      "uuid": "123e4567-e89b-12d3-a456-426614174004",
      "full_name": "Tim Robbins"
    },
    {
      "uuid": "123e4567-e89b-12d3-a456-426614174005",
      "full_name": "Morgan Freeman"
    }
  ],
  "writers": [
    {
      "uuid": "123e4567-e89b-12d3-a456-426614174006",
      "full_name": "Stephen King"
    }
  ]
}
```

#### Похожие фильмы
- **GET** `/api/v1/films/{film_id}/similar`
- **Описание**: Получение списка похожих фильмов
- **Аутентификация**: Не требуется
- **Параметры пути**: `film_id` (string)
- **Параметры запроса**:
  - `page_size` (int, 1-100): Количество фильмов на странице
  - `page_number` (int, ≥1): Номер страницы
- **Ответ**:
```json
[
  {
    "uuid": "123e4567-e89b-12d3-a456-426614174007",
    "imdb_rating": 8.0,
    "title": "The Green Mile"
  },
  {
    "uuid": "123e4567-e89b-12d3-a456-426614174008",
    "imdb_rating": 7.5,
    "title": "Forrest Gump"
  }
]
```

#### Рекомендации для пользователя
- **GET** `/api/v1/films/recommendations/{user_id}`
- **Описание**: Персональные рекомендации фильмов для пользователя
- **Аутентификация**: Не требуется
- **Параметры пути**: `user_id` (string)
- **Параметры запроса**:
  - `page_size` (int, 1-100): Количество фильмов на странице
  - `page_number` (int, ≥1): Номер страницы
- **Ответ**:
```json
[
  {
    "uuid": "123e4567-e89b-12d3-a456-426614174009",
    "imdb_rating": 8.2,
    "title": "Pulp Fiction"
  }
]
```

#### Общие рекомендации
- **GET** `/api/v1/films/recommendations`
- **Описание**: Общие рекомендации фильмов
- **Аутентификация**: Не требуется
- **Параметры запроса**:
  - `page_size` (int, 1-100): Количество фильмов на странице
  - `page_number` (int, ≥1): Номер страницы
- **Ответ**:
```json
[
  {
    "uuid": "123e4567-e89b-12d3-a456-426614174010",
    "imdb_rating": 8.8,
    "title": "The Dark Knight"
  }
]
```

### Персоны (Persons)

#### Список персон
- **GET** `/api/v1/persons/` или `/api/v1/persons/search`
- **Описание**: Получение списка персон с поиском
- **Аутентификация**: Не требуется
- **Параметры запроса**:
  - `page_size` (int, 1-100): Количество персон на странице (по умолчанию 50)
  - `page_number` (int, ≥1): Номер страницы (по умолчанию 1)
  - `query` (string, опционально): Поиск по имени
  - `sort` (string): Сортировка (по умолчанию "-full_name")
- **Ответ**:
```json
[
  {
    "uuid": "123e4567-e89b-12d3-a456-426614174003",
    "full_name": "Frank Darabont",
    "films": [
      {
        "uuid": "123e4567-e89b-12d3-a456-426614174000",
        "roles": ["director"]
      }
    ]
  }
]
```

#### Детальная информация о персоне
- **GET** `/api/v1/persons/{person_id}`
- **Описание**: Получение полной информации о персоне
- **Аутентификация**: Не требуется
- **Параметры пути**: `person_id` (string)
- **Ответ**:
```json
{
  "uuid": "123e4567-e89b-12d3-a456-426614174003",
  "full_name": "Frank Darabont",
  "films": [
    {
      "uuid": "123e4567-e89b-12d3-a456-426614174000",
      "roles": ["director"]
    },
    {
      "uuid": "123e4567-e89b-12d3-a456-426614174007",
      "roles": ["director", "writer"]
    }
  ]
}
```

#### Фильмы персоны
- **GET** `/api/v1/persons/{person_id}/films`
- **Описание**: Получение списка фильмов персоны
- **Аутентификация**: Не требуется
- **Параметры пути**: `person_id` (string)
- **Ответ**:
```json
[
  {
    "uuid": "123e4567-e89b-12d3-a456-426614174000",
    "title": "The Shawshank Redemption",
    "imdb_rating": 8.5
  },
  {
    "uuid": "123e4567-e89b-12d3-a456-426614174007",
    "title": "The Green Mile",
    "imdb_rating": 8.0
  }
]
```

### Жанры (Genres)

#### Список жанров
- **GET** `/api/v1/genres/` или `/api/v1/genres/search`
- **Описание**: Получение списка жанров с поиском
- **Аутентификация**: Не требуется
- **Параметры запроса**:
  - `page_size` (int, 1-100): Количество жанров на странице (по умолчанию 50)
  - `page_number` (int, ≥1): Номер страницы (по умолчанию 1)
  - `query` (string, опционально): Поиск по названию жанра
- **Ответ**:
```json
[
  {
    "uuid": "123e4567-e89b-12d3-a456-426614174002",
    "name": "Drama"
  },
  {
    "uuid": "123e4567-e89b-12d3-a456-426614174011",
    "name": "Action"
  }
]
```

#### Детальная информация о жанре
- **GET** `/api/v1/genres/{genre_id}`
- **Описание**: Получение жанра с фильмами
- **Аутентификация**: Не требуется
- **Параметры пути**: `genre_id` (UUID)
- **Параметры запроса**:
  - `page_size` (int, 1-100): Количество фильмов на странице
  - `page_number` (int, ≥1): Номер страницы
  - `sort` (string): Сортировка (по умолчанию "-imdb_rating")
- **Ответ**:
```json
{
  "uuid": "123e4567-e89b-12d3-a456-426614174002",
  "name": "Drama",
  "films": [
    {
      "uuid": "123e4567-e89b-12d3-a456-426614174000",
      "title": "The Shawshank Redemption",
      "imdb_rating": 8.5
    },
    {
      "uuid": "123e4567-e89b-12d3-a456-426614174001",
      "title": "The Godfather",
      "imdb_rating": 9.0
    }
  ]
}
```

## База данных

Сервис использует Elasticsearch для поиска и PostgreSQL для хранения данных.

## Тестирование

Тесты API располагаются в папке `theatre-api/tests/functional`

Для запуска тестов нужно перейти в папку выше и запустить `docker compose up -d`
