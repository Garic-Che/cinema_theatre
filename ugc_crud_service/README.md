# ugc_crud_service

Сервис для управления пользовательским контентом (User Generated Content) - лайки, закладки и комментарии.

## Swagger-документация

[api/v1/ugc_crud/openapi](http://127.0.0.1/api/v1/ugc_crud/openapi)

## Эндпоинты

### Лайки (Likes)

#### Создание лайков
- **POST** `/api/v1/likes/create`
- **Описание**: Лайк от пользователя
- **Аутентификация**: JWT токен
- **Тело запроса**:
```json
[
  {
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "content_id": "123e4567-e89b-12d3-a456-426614174001",
    "created_at": "2024-01-01T00:00:00",
    "rate": 8
  }
]
```
- **Ответ**:
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174002",
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "content_id": "123e4567-e89b-12d3-a456-426614174001",
    "created_at": "2024-01-01T00:00:00",
    "rate": 8
  }
]
```

#### Лайки пользователя
- **GET** `/api/v1/likes/user/{user_id}`
- **Описание**: Получение всех лайков от пользователя
- **Аутентификация**: JWT токен
- **Параметры пути**: `user_id` (UUID)
- **Ответ**:
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174002",
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "content_id": "123e4567-e89b-12d3-a456-426614174001",
    "created_at": "2024-01-01T00:00:00",
    "rate": 8
  }
]
```

#### Лайки контента
- **GET** `/api/v1/likes/content/{content_id}`
- **Описание**: Получение всех лайков контента
- **Аутентификация**: JWT токен
- **Параметры пути**: `content_id` (UUID)
- **Ответ**:
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174002",
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "content_id": "123e4567-e89b-12d3-a456-426614174001",
    "created_at": "2024-01-01T00:00:00",
    "rate": 8
  }
]
```

#### Лайки по временному диапазону
- **GET** `/api/v1/likes/timerange/{start}/{end}`
- **Описание**: Получение лайков за период времени
- **Аутентификация**: JWT токен
- **Параметры пути**: `start` (datetime), `end` (datetime)
- **Ответ**:
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174002",
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "content_id": "123e4567-e89b-12d3-a456-426614174001",
    "created_at": "2024-01-01T00:00:00",
    "rate": 8
  }
]
```

#### Удаление лайков
- **DELETE** `/api/v1/likes/remove`
- **Описание**: Удаление лайков по ID
- **Аутентификация**: JWT токен
- **Тело запроса**:
```json
["123e4567-e89b-12d3-a456-426614174002"]
```
- **Ответ**:
```json
["123e4567-e89b-12d3-a456-426614174002"]
```

#### Обновление лайка
- **PUT** `/api/v1/likes/update`
- **Описание**: Обновление лайка
- **Аутентификация**: JWT токен
- **Тело запроса**:
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174002",
  "rate": 9
}
```
- **Ответ**:
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174002",
  "user_id": "123e4567-e89b-12d3-a456-426614174000",
  "content_id": "123e4567-e89b-12d3-a456-426614174001",
  "created_at": "2024-01-01T00:00:00",
  "rate": 9
}
```

#### Средняя оценка контента
- **GET** `/api/v1/likes/avg_rate/{content_id}`
- **Описание**: Получение средней оценки контента
- **Аутентификация**: Не требуется
- **Параметры пути**: `content_id` (UUID)
- **Ответ**:
```json
8.5
```

### Закладки (Bookmarks)

#### Создание закладок
- **POST** `/api/v1/bookmarks/create`
- **Описание**: Создание закладки пользователем
- **Аутентификация**: JWT токен
- **Тело запроса**:
```json
[
  {
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "content_id": "123e4567-e89b-12d3-a456-426614174001",
    "created_at": "2024-01-01T00:00:00"
  }
]
```
- **Ответ**:
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174003",
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "content_id": "123e4567-e89b-12d3-a456-426614174001",
    "created_at": "2024-01-01T00:00:00"
  }
]
```

#### Закладки пользователя
- **GET** `/api/v1/bookmarks/user/{user_id}`
- **Описание**: Получение всех закладок пользователя
- **Аутентификация**: JWT токен
- **Параметры пути**: `user_id` (UUID)
- **Ответ**:
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174003",
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "content_id": "123e4567-e89b-12d3-a456-426614174001",
    "created_at": "2024-01-01T00:00:00"
  }
]
```

#### Закладки контента
- **GET** `/api/v1/bookmarks/content/{content_id}`
- **Описание**: Получение всех закладок для контента
- **Аутентификация**: JWT токен
- **Параметры пути**: `content_id` (UUID)
- **Ответ**:
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174003",
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "content_id": "123e4567-e89b-12d3-a456-426614174001",
    "created_at": "2024-01-01T00:00:00"
  }
]
```

#### Закладки по временному диапазону
- **GET** `/api/v1/bookmarks/timerange/{start}/{end}`
- **Описание**: Получение закладок за период времени
- **Аутентификация**: JWT токен
- **Параметры пути**: `start` (datetime), `end` (datetime)
- **Ответ**:
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174003",
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "content_id": "123e4567-e89b-12d3-a456-426614174001",
    "created_at": "2024-01-01T00:00:00"
  }
]
```

#### Удаление закладок
- **DELETE** `/api/v1/bookmarks/remove`
- **Описание**: Удаление закладок по ID
- **Аутентификация**: JWT токен
- **Тело запроса**:
```json
["123e4567-e89b-12d3-a456-426614174003"]
```
- **Ответ**:
```json
["123e4567-e89b-12d3-a456-426614174003"]
```

#### Обновление закладки
- **PUT** `/api/v1/bookmarks/update`
- **Описание**: Обновление закладки
- **Аутентификация**: JWT токен
- **Тело запроса**:
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174003",
  "content_id": "123e4567-e89b-12d3-a456-426614174004"
}
```
- **Ответ**:
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174003",
  "user_id": "123e4567-e89b-12d3-a456-426614174000",
  "content_id": "123e4567-e89b-12d3-a456-426614174004",
  "created_at": "2024-01-01T00:00:00"
}
```

### Комментарии (Comments)

#### Создание комментариев
- **POST** `/api/v1/comments/create`
- **Описание**: Создание комментария пользователем
- **Аутентификация**: JWT токен
- **Тело запроса**:
```json
[
  {
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "content_id": "123e4567-e89b-12d3-a456-426614174001",
    "created_at": "2024-01-01T00:00:00",
    "text": "Отличный фильм!"
  }
]
```
- **Ответ**:
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174004",
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "content_id": "123e4567-e89b-12d3-a456-426614174001",
    "created_at": "2024-01-01T00:00:00",
    "text": "Отличный фильм!"
  }
]
```

#### Комментарии пользователя
- **GET** `/api/v1/comments/user/{user_id}`
- **Описание**: Получение всех комментариев пользователя
- **Аутентификация**: JWT токен
- **Параметры пути**: `user_id` (UUID)
- **Ответ**:
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174004",
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "content_id": "123e4567-e89b-12d3-a456-426614174001",
    "created_at": "2024-01-01T00:00:00",
    "text": "Отличный фильм!"
  }
]
```

#### Комментарии контента
- **GET** `/api/v1/comments/content/{content_id}`
- **Описание**: Получение всех комментариев для контента
- **Аутентификация**: JWT токен
- **Параметры пути**: `content_id` (UUID)
- **Ответ**:
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174004",
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "content_id": "123e4567-e89b-12d3-a456-426614174001",
    "created_at": "2024-01-01T00:00:00",
    "text": "Отличный фильм!"
  }
]
```

#### Комментарии по временному диапазону
- **GET** `/api/v1/comments/timerange/{start}/{end}`
- **Описание**: Получение комментариев за период времени
- **Аутентификация**: JWT токен
- **Параметры пути**: `start` (datetime), `end` (datetime)
- **Ответ**:
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174004",
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "content_id": "123e4567-e89b-12d3-a456-426614174001",
    "created_at": "2024-01-01T00:00:00",
    "text": "Отличный фильм!"
  }
]
```

#### Удаление комментариев
- **DELETE** `/api/v1/comments/remove`
- **Описание**: Удаление комментариев по ID
- **Аутентификация**: JWT токен
- **Тело запроса**:
```json
["123e4567-e89b-12d3-a456-426614174004"]
```
- **Ответ**:
```json
["123e4567-e89b-12d3-a456-426614174004"]
```

#### Обновление комментария
- **PUT** `/api/v1/comments/update`
- **Описание**: Обновление комментария
- **Аутентификация**: JWT токен
- **Тело запроса**:
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174004",
  "text": "Очень хороший фильм!"
}
```
- **Ответ**:
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174004",
  "user_id": "123e4567-e89b-12d3-a456-426614174000",
  "content_id": "123e4567-e89b-12d3-a456-426614174001",
  "created_at": "2024-01-01T00:00:00",
  "text": "Очень хороший фильм!"
}
```

#### Поиск комментариев
- **GET** `/api/v1/comments/search/{term}`
- **Описание**: Поиск комментариев по тексту
- **Аутентификация**: JWT токен
- **Параметры пути**: `term` (string) - поисковый запрос
- **Ответ**:
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174004",
    "user_id": "123e4567-e89b-12d3-a456-426614174000",
    "content_id": "123e4567-e89b-12d3-a456-426614174001",
    "created_at": "2024-01-01T00:00:00",
    "text": "Отличный фильм!"
  }
]
```

## Аутентификация

Сервис поддерживает JWT аутентификацию:
- **JWT токен** - для авторизованных пользователей через заголовок `Authorization: Bearer <token>`

## База данных

Сервис использует MongoDB для хранения данных:
- **Драйвер**: Motor (асинхронный)
- **ORM**: Beanie (асинхронный ODM)
- **Индексы**: Уникальные индексы для лайков и закладок, текстовый индекс для комментариев

## Уведомления

Сервис автоматически отправляет уведомления при создании лайков и комментариев.

## Ограничения

- **Лайки**: Оценка от 0 до 10
- **Уникальность**: Пользователь может поставить только один лайк/закладку на контент
- **Авторизация**: Пользователи могут изменять/удалять только свои записи
